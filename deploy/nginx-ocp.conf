# OnChainPoker â€” add to discordwell.com server block
# Place these location blocks inside the existing server { ... } in nginx.discordwell.com.conf
# Also add this map block OUTSIDE the server block (at http level):
#
#   map $http_upgrade $connection_upgrade {
#       default upgrade;
#       ''      close;
#   }

# Canonical /ocp with trailing slash
location = /ocp {
    return 308 /ocp/;
}

# OCP web UI (static Vite build)
location /ocp/ {
    alias /opt/ocp/web/dist/;
    try_files $uri /ocp/index.html;
}

# OCP coordinator API proxy
location /ocp/api/ {
    proxy_pass http://127.0.0.1:8788/;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Prefix /ocp/api;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection $connection_upgrade;
    proxy_read_timeout 300s;
}
